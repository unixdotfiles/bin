#!/bin/sh

SANITZERS="alignment, \
  bool, \
  bounds, \
  enum, \
  float-cast-overflow, \
  float-divide-by-zero, \
  integer-divide-by-zero, \
  nonnull-attribute, \
  null, \
  nullability-arg, \
  nullability-assign, \
  nullability-return, \
  object-size, \
  pointer-overflow, \
  return, \
  unsigned-integer-overflow, \
  returns-nonnull-attribute, \
  shift, \
  signed-integer-overflow, \
  unreachable, \
  vla-bound, \
  vptr, \
  address
"

WARNS="-Weverything \
-Wno-padded \
-Wno-missing-noreturn \
-Wno-vla \
-Wno-disabled-macro-expansion
"

# -fsanitize=memory,thread

SANITZERS="$(printf "$SANITZERS" | tr -d ' ')"

exec clang \
  $WARNS \
  -fsanitize="$SANITZERS" \
  -flto \
  -fwhole-program-vtables \
  -fstrict-vtable-pointers \
  -fdiagnostics-show-category=name \
  -fdiagnostics-show-template-tree \
  -D_CONST_X_STRING \
  -D_FORTIFY_SOURCE=2 \
  -g \
  "$@"
